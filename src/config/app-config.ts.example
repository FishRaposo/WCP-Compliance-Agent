/**
 * Application Configuration - EXAMPLE/MOCKUP
 * 
 * This is a mockup/example file showing the application configuration structure.
 * 
 * Status: Not yet implemented (Phase 1: Core Improvements)
 * 
 * To implement:
 * 1. Copy this file to src/config/app-config.ts
 * 2. Implement configuration loading
 * 3. Import and use in application
 * 4. Add tests for configuration
 * 
 * @file src/config/app-config.ts.example
 * @see TODO.md - Item 4: Configuration and Environment Setup
 */

import { z } from 'zod';
import { validateEnv } from '../utils/env-validator.js';
import { ConfigurationError } from '../utils/error-handler.js';

/**
 * Application Configuration Schema
 * 
 * Defines the structure of application configuration.
 */
const AppConfigSchema = z.object({
  openai: z.object({
    apiKey: z.string(),
    model: z.string().default('gpt-4o-mini'),
  }),
  agent: z.object({
    maxSteps: z.number().default(3),
  }),
  logging: z.object({
    level: z.enum(['debug', 'info', 'warn', 'error']).default('info'),
  }),
  environment: z.enum(['development', 'production', 'test']).default('development'),
});

/**
 * Application Configuration Type
 * 
 * TypeScript type inferred from AppConfigSchema.
 */
export type AppConfig = z.infer<typeof AppConfigSchema>;

/**
 * Load Application Configuration
 * 
 * Loads and validates application configuration from environment variables.
 * 
 * @returns Validated application configuration
 * @throws ConfigurationError if configuration is invalid
 * 
 * @example
 * ```typescript
 * import { loadConfig } from './config/app-config.js';
 * 
 * const config = loadConfig();
 * console.log(`Using model: ${config.openai.model}`);
 * ```
 */
export function loadConfig(): AppConfig {
  try {
    const env = validateEnv();
    
    return AppConfigSchema.parse({
      openai: {
        apiKey: env.OPENAI_API_KEY,
        model: env.OPENAI_MODEL,
      },
      agent: {
        maxSteps: env.AGENT_MAX_STEPS,
      },
      logging: {
        level: env.LOG_LEVEL,
      },
      environment: env.NODE_ENV,
    });
  } catch (error) {
    if (error instanceof z.ZodError) {
      throw new ConfigurationError('Invalid application configuration', {
        errors: error.errors,
      });
    }
    throw error;
  }
}

/**
 * Default Configuration
 * 
 * Default configuration values for development.
 */
export const defaultConfig: AppConfig = {
  openai: {
    apiKey: '',
    model: 'gpt-4o-mini',
  },
  agent: {
    maxSteps: 3,
  },
  logging: {
    level: 'info',
  },
  environment: 'development',
};

