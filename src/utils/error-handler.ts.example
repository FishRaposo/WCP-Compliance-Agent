/**
 * Error Handler Utility - EXAMPLE/MOCKUP
 * 
 * This is a mockup/example file showing the error handler utility structure.
 * 
 * Status: Not yet implemented (Phase 0 MVP)
 * 
 * To implement:
 * 1. Copy this file to src/utils/error-handler.ts
 * 2. Implement error classes
 * 3. Import and use in tools and agents
 * 4. Add tests for error handling
 * 
 * @file src/utils/error-handler.ts.example
 * @see TODO.md - Item 1: Error Handling and Input Validation
 */

/**
 * Base WCP Error Class
 * 
 * All WCP-specific errors extend this class.
 * Provides consistent error structure with code, statusCode, and details.
 */
export class WCPError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode: number = 500,
    public details?: Record<string, unknown>
  ) {
    super(message);
    this.name = 'WCPError';
    // Maintains proper stack trace for where error was thrown
    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, WCPError);
    }
  }
}

/**
 * Validation Error
 * 
 * Thrown when input validation fails.
 * Status code: 400 (Bad Request)
 */
export class ValidationError extends WCPError {
  constructor(message: string, details?: Record<string, unknown>) {
    super(message, 'VALIDATION_ERROR', 400, details);
    this.name = 'ValidationError';
  }
}

/**
 * API Error
 * 
 * Thrown when external API calls fail.
 * Status code: 502 (Bad Gateway)
 */
export class APIError extends WCPError {
  constructor(message: string, details?: Record<string, unknown>) {
    super(message, 'API_ERROR', 502, details);
    this.name = 'APIError';
  }
}

/**
 * Configuration Error
 * 
 * Thrown when configuration is invalid or missing.
 * Status code: 500 (Internal Server Error)
 */
export class ConfigurationError extends WCPError {
  constructor(message: string, details?: Record<string, unknown>) {
    super(message, 'CONFIGURATION_ERROR', 500, details);
    this.name = 'ConfigurationError';
  }
}

/**
 * Unexpected Error
 * 
 * Thrown when an unexpected error occurs.
 * Status code: 500 (Internal Server Error)
 */
export class UnexpectedError extends WCPError {
  constructor(message: string, originalError?: unknown, details?: Record<string, unknown>) {
    super(
      message,
      'UNEXPECTED_ERROR',
      500,
      {
        ...details,
        originalError: originalError instanceof Error ? originalError.message : String(originalError),
      }
    );
    this.name = 'UnexpectedError';
  }
}

/**
 * Error Response Format
 * 
 * Standardized error response structure for API responses.
 */
export interface ErrorResponse {
  error: {
    code: string;
    message: string;
    statusCode: number;
    details?: Record<string, unknown>;
    timestamp: string;
    traceId?: string;
  };
}

/**
 * Convert WCPError to ErrorResponse
 * 
 * @param error - The error to convert
 * @param traceId - Optional trace ID for request tracking
 * @returns Formatted error response
 */
export function toErrorResponse(error: WCPError, traceId?: string): ErrorResponse {
  return {
    error: {
      code: error.code,
      message: error.message,
      statusCode: error.statusCode,
      details: error.details,
      timestamp: new Date().toISOString(),
      traceId,
    },
  };
}

/**
 * Check if error is a WCPError
 * 
 * @param error - The error to check
 * @returns True if error is a WCPError
 */
export function isWCPError(error: unknown): error is WCPError {
  return error instanceof WCPError;
}

